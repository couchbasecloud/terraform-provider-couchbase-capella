---
layout: "couchbase-capella"
page_title: "Couchbase Capella Provider 1.6.0: Upgrade and Information Guide"
sidebar_current: "docs-couchbase-capella-guides-160-upgrade-guide"
description: |-
Couchbase Capella Provider 1.6.0: Upgrade and Information Guide
---

# Couchbase Capella Provider 1.6.0: Upgrade and Information Guide

Here is a list of what's new in 1.6.0

## New Features

* Create and manage cloud snapshot backups with [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup)
* Create and manage cloud snapshot backup schedules with [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule)
* Restore clusters from cloud snapshot backups
* Retrieve cloud snapshot backups with [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup) and [`couchbase-capella_cloud_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backups) data sources
* Retrieve cloud snapshot backup schedules with [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup_schedule)
* Retrieve cloud snapshot restores with [`couchbase-capella_cloud_snapshot_restore`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restore) and [`couchbase-capella_cloud_snapshot_restores`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restores)
* Create and manage App Endpoints with [`couchbase-capella_app_endpoint`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint)
* Manage App Endpoint activation status with [`couchbase-capella_app_endpoint_activation_status`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_activation_status)
* Configure OIDC providers for App Endpoints with [`couchbase-capella_app_endpoint_oidc_provider`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_oidc_provider)
* Configure default OIDC provider for App Endpoints with [`couchbase-capella_app_endpoint_default_oidc_provider`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_default_oidc_provider)
* Configure CORS for App Endpoints with [`couchbase-capella_app_endpoint_cors`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_cors)
* Configure import filters for App Endpoints with [`couchbase-capella_app_endpoint_import_filter`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_import_filter)
* Configure access control functions for App Endpoints with [`couchbase-capella_app_endpoint_access_control_function`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_access_control_function)
* Trigger App Endpoint resync with [`couchbase-capella_app_endpoint_resync`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/app_endpoint_resync)
* Automatically extract field descriptions from OpenAPI specification for enhanced documentation
* Support for Magma buckets in Couchbase Server 8.x
* Generate OpenAPI v2 client for future API migration

## Bug Fixes

* Fix App Services Allowed CIDRs field requirement and error handling
* Fix App Endpoint activation status null checks on import
* Fix App Endpoint OIDC schema by using slice instead of Set
* Add missing App Endpoint CORS and resync examples
* Provider no longer sets bucket defaults automatically
* Fix API key rotation to use token from API response instead of constructing from Id and Secret
* Fix API key rotation endpoint success status code (200 instead of 201)
* Fix acceptance test `TestAccClusterResourceWithOnlyReqFieldAWS`

## Changes

There are no deprecations as part of this release.

1.6.0 includes new features and general improvements. See the [CHANGELOG](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/CHANGELOG.md) for more specific information.

* Manage Cloud Snapshot Backups [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup)
* Manage Cloud Snapshot Backup Schedules [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule)
* Retrieve Cloud Snapshot Backups [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup)
* Retrieve Cloud Snapshot Backup List [`couchbase-capella_cloud_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backups)
* Retrieve Cloud Snapshot Backup Schedule [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup_schedule)
* Retrieve Cloud Snapshot Restore [`couchbase-capella_cloud_snapshot_restore`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restore)
* Retrieve Cloud Snapshot Restores [`couchbase-capella_cloud_snapshot_restores`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restores)
* Manage App Endpoint [`couchbase-capella_app_endpoint`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint)
* Retrieve App Endpoint [`couchbase-capella_app_endpoint`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/app_endpoint)
* Retrieve App Endpoints List [`couchbase-capella_app_endpoints`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/app_endpoints)
* Manage App Endpoint Activation Status [`couchbase-capella_app_endpoint_activation_status`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_activation_status)
* Retrieve App Endpoint Activation Status [`couchbase-capella_app_endpoint_activation_status`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/app_endpoint_activation_status)
* Manage App Endpoint OIDC Provider [`couchbase-capella_app_endpoint_oidc_provider`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_oidc_provider)
* Manage App Endpoint Default OIDC Provider [`couchbase-capella_app_endpoint_default_oidc_provider`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_default_oidc_provider)
* Manage App Endpoint CORS [`couchbase-capella_app_endpoint_cors`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_cors)
* Manage App Endpoint Import Filter [`couchbase-capella_app_endpoint_import_filter`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_import_filter)
* Manage App Endpoint Access Control Function [`couchbase-capella_app_endpoint_access_control_function`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/app_endpoint_access_control_function)
* Retrieve App Endpoint Resync [`couchbase-capella_app_endpoint_resync`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/app_endpoint_resync)

## Breaking Changes

**WARNING: ACTION REQUIRED** - The following changes may require updates to your Terraform configurations:

### Private Endpoints - Service Name Field Added

The `couchbase-capella_private_endpoint_service` resource and data source now include a required `service_name` field for AWS private endpoints.

**Migration:** If you are using private endpoints with AWS, update your configurations to include the `service_name` field:

```terraform
resource "couchbase-capella_private_endpoint_service" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
  
  service_name = "com.amazonaws.vpce.us-east-1.vpce-svc-xxxxx"  # Add this field
  # ... rest of configuration
}
```

### Cluster Import Command - Removed cluster_id Parameter

The import command for clusters has been simplified. The `cluster_id` parameter is no longer required.

**Before:**
```bash
terraform import couchbase-capella_cluster.new_cluster id=<cluster_id>,cluster_id=<cluster_id>,project_id=<project_id>,organization_id=<organization_id>
```

**After:**
```bash
terraform import couchbase-capella_cluster.new_cluster id=<cluster_id>,project_id=<project_id>,organization_id=<organization_id>
```

## Cloud Snapshot Backups

Use the `couchbase-capella_cloud_snapshot_backup` resource to create and manage on-demand cloud snapshot backups for your clusters. Cloud snapshots provide point-in-time backups stored in your cloud provider's native storage.

```terraform
resource "couchbase-capella_cloud_snapshot_backup" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
  
  bucket_id = var.bucket_id
}
```

To create scheduled backups, use the `couchbase-capella_cloud_snapshot_backup_schedule` resource:

```terraform
resource "couchbase-capella_cloud_snapshot_backup_schedule" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
  
  type              = "weekly"
  weekly_schedule = {
    day        = "monday"
    start_at   = 12
    incremental_every = 6
    retention_time    = "30days"
  }
}
```

Retrieve backup information using data sources:

```terraform
data "couchbase-capella_cloud_snapshot_backups" "all" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}
```

For more information, see the [cloud snapshot backup examples](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/backup).

## Cluster Restore from Snapshots

You can now restore clusters from cloud snapshot backups by referencing a snapshot ID during cluster creation. This enables disaster recovery and cluster cloning scenarios.

To retrieve available restores:

```terraform
data "couchbase-capella_cloud_snapshot_restores" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}
```

## App Endpoints

App Endpoints provide secure, public-facing access to your Capella App Services. This release introduces comprehensive support for creating and configuring App Endpoints with fine-grained access control.

Create an App Endpoint:

```terraform
resource "couchbase-capella_app_endpoint" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  
  name        = "my-app-endpoint"
  description = "Public endpoint for mobile sync"
}
```

Configure OIDC authentication:

```terraform
resource "couchbase-capella_app_endpoint_oidc_provider" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  app_endpoint_id = couchbase-capella_app_endpoint.example.id
  
  name          = "auth0"
  issuer        = "https://your-domain.auth0.com/"
  client_id     = var.oidc_client_id
  register_url  = "https://your-domain.auth0.com/authorize"
  user_prefix   = "auth0_"
}
```

Configure CORS:

```terraform
resource "couchbase-capella_app_endpoint_cors" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  app_endpoint_id = couchbase-capella_app_endpoint.example.id
  
  enabled         = true
  allowed_origins = ["https://app.example.com", "https://staging.example.com"]
  max_age_seconds = 3600
}
```

Set up import filters for data replication:

```terraform
resource "couchbase-capella_app_endpoint_import_filter" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  app_endpoint_id = couchbase-capella_app_endpoint.example.id
  
  expression = "type='public' AND status='active'"
}
```

Configure custom access control:

```terraform
resource "couchbase-capella_app_endpoint_access_control_function" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  app_endpoint_id = couchbase-capella_app_endpoint.example.id
  
  code = <<-EOT
    function(doc, oldDoc) {
      if (doc.type === 'private') {
        requireUser(doc.owner);
      }
    }
  EOT
}
```

Manage activation status:

```terraform
resource "couchbase-capella_app_endpoint_activation_status" "example" {
  organization_id = var.organization_id
  project_id      = var.project_id
  app_service_id  = var.app_service_id
  app_endpoint_id = couchbase-capella_app_endpoint.example.id
  
  status = "active"
}
```

For more information, see the [App Endpoint examples](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/app_endpoint).

### Helpful Links

- [Getting Started with the Terraform Provider](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples/getting_started)
- [Capella Management API v4.0](https://docs.couchbase.com/cloud/management-api-reference/index.html)
- [See Specific Examples](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples)

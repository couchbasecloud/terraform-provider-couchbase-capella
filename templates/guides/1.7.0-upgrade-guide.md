---
layout: "couchbase-capella"
page_title: "Couchbase Capella Provider 1.7.0: Upgrade and Information Guide"
sidebar_current: "docs-couchbase-capella-guides-170-upgrade-guide"
description: |-
Couchbase Capella Provider 1.7.0: Upgrade and Information Guide
---

# Couchbase Capella Provider 1.7.0: Upgrade and Information Guide

Here is a list of what's new in 1.7.0

## New Features

### Cloud Snapshot Backups

Version 1.7.0 introduces comprehensive support for managing Cloud Snapshot Backups directly through Terraform. You can now create on-demand backups, configure backup schedules, and manage backup retention policies as Terraform resources.

Cloud Snapshot Backups provide point-in-time recovery capabilities for your Couchbase Capella clusters. With these new resources, you can automate your backup strategy, enforce retention policies, and configure cross-region backup copies for disaster recovery.

**New Resources:**
* [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup) - Create and manage on-demand cloud snapshot backups
* [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule) - Configure automated backup schedules

**New Data Sources:**
* [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup) - Retrieve cloud snapshot backup details
* [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup_schedule) - Retrieve backup schedule configuration

Example - Creating an on-demand cloud snapshot backup:

```terraform
resource "couchbase-capella_cloud_snapshot_backup" "daily_backup" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id

  retention       = 168  # Retention in hours (7 days)
  regions_to_copy = ["us-west-2"]  # Optional: copy to additional region
}
```

Example - Configuring a backup schedule:

```terraform
resource "couchbase-capella_cloud_snapshot_backup_schedule" "weekly_schedule" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id

  interval   = 24        # Backup interval in hours
  retention  = 720       # Retention in hours (30 days)
  start_time = "2024-01-01T02:00:00Z"
}
```

**Additional Examples:**

For comprehensive examples of Cloud Snapshot Backup features, see:

* [Cloud Snapshot Backup](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/backup) - Creating and managing backups
* [Backup Schedule](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/backup_schedule) - Configuring automated backup schedules

### Backup Enhancements

* **Restore Validation**: The provider now prevents attempts to restore a snapshot backup before it has been fully created, avoiding potential errors during restore operations.
* **Region Copy Limits**: Enforced validation to ensure a maximum of two regions can be selected for `regions_to_copy`, aligning with API constraints.

## Bug Fixes

* **GSI Data Source Schema**: Reverted the GSI datasource schema to its original state to fix unintentional schema changes.
* **GSI Monitor Schema**: Reverted the GSI monitor schema to its original state, correcting changes that were introduced unintentionally.
* **GSI Index Import**: Fixed a null pointer exception that occurred during GSI index imports.
* **Replica Validation**: Added validation to prevent setting the number of replicas to zero, which is not supported.
* **Replica Zero Value**: Fixed an issue where a zero value for `num_replicas` was not being properly populated.
* **Optional Field Defaults**: Corrected handling of optional fields that have non-zero defaults on the server side, ensuring the provider does not unintentionally override server-determined values.
* **Example Variables**: Set default values for optional variables in examples to prevent users from being prompted for values they may not need.

## Changes

There are no deprecations as part of this release.

1.7.0 includes new features and general improvements. See the [CHANGELOG](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/CHANGELOG.md) for more specific information.

### New Resources and Data Sources

* Manage Cloud Snapshot Backups [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup)
* Manage Backup Schedules [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule)

## Notes

### Migration from Older Versions

If you're upgrading from an earlier version of the provider:

1. **GSI Configurations**: If you experienced issues with GSI data sources or monitors in previous versions, these have been resolved. No action is required, but you may want to verify your GSI configurations after upgrading.
Default Value Change for GSI **num_replica**
Field: **with.num_replica** in the couchbase-capella_query_indexes resource
Change:
**Previous behavior:** num_replica may have required explicit specification or had a hardcoded default to zero
**Current behavior (post-1.7.0):** num_replica is now computed and known after `apply` operation, and defined by server (server-determined)

### Helpful Links

- [Getting Started with the Terraform Provider](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples/getting_started)
- [Capella Management API v4.0](https://docs.couchbase.com/cloud/management-api-reference/index.html)
- [See Specific Examples](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples)

---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "couchbase-capella_query_indexes Resource - terraform-provider-couchbase-capella"
subcategory: ""
description: |-
  Manages Query Indexes in Couchbase Capella
---

# couchbase-capella_query_indexes (Resource)

Manages Query Indexes in Couchbase Capella

## Example Usage

```terraform
# Example json file -
  {
  "resource": {
    "couchbase-capella_indexes": {
      "idx1": {
        "organization_id": "ffffffff-aaaa-1414-eeee-000000000000",
        "project_id": "ffffffff-aaaa-1414-eeee-000000000000",
        "cluster_id": "ffffffff-aaaa-1414-eeee-000000000000",
        "bucket_name": "api",
        "scope_name": "metrics",
        "scope_name": "memory",
        "index_name": "idx1",
        "index_keys": [
          "field1"
        ],
        "with": {
          "defer_build": true
        }
      },
    "idx2": {
          "organization_id": "ffffffff-aaaa-1414-eeee-000000000000",
          "project_id": "ffffffff-aaaa-1414-eeee-000000000000",
          "cluster_id": "ffffffff-aaaa-1414-eeee-000000000000",
          "bucket_name": "api",
          "scope_name": "metrics",
          "scope_name": "memory",
          "index_name": "idx2",
          "index_keys": [
            "field2"
          ],
          "with": {
            "defer_build": true
             }
          }
        }
      }
    }

# Example for deferred index build -
locals {
  index_template = templatefile("${path.module}/indexes.json", {
    organization_id = "ffffffff-aaaa-1414-eeee-000000000000"
    project_id      = "ffffffff-aaaa-1414-eeee-000000000000"
    cluster_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  })

  decoded_template = jsondecode(local.index_template)
  index_names      = [for idx, details in local.decoded_template.resource["couchbase-capella_indexes"] : details.index_name]
}

resource "couchbase-capella_query_indexes" "new_indexes" {
  for_each        = jsondecode(local.index_template).resource["couchbase-capella_indexes"]
  organization_id = each.value.organization_id
  project_id      = each.value.project_id
  cluster_id      = each.value.cluster_id
  bucket_name     = each.value.bucket_name
  scope_name      = each.value.scope_name
  collection_name = each.value.collection_name
  index_name      = each.value.index_name
  index_keys      = each.value.index_keys
  with = {
    defer_build = each.value.with.defer_build
  }
}

resource "couchbase-capella_query_indexes" "build_idx" {
  organization_id = "ffffffff-aaaa-1414-eeee-000000000000"
  project_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  cluster_id      = "ffffffff-aaaa-1414-eeee-000000000000"

  bucket_name     = "api"
  scope_name      = "metrics"
  collection_name = "memory"

  build_indexes = local.index_names

  depends_on = [couchbase-capella_query_indexes.new_indexes]
}

data "couchbase-capella_query_index_monitor" "mon_indexes" {
  organization_id = "ffffffff-aaaa-1414-eeee-000000000000"
  project_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  cluster_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  bucket_name     = "api"
  scope_name      = "metrics"
  collection_name = "memory"
  indexes         = local.index_names

  depends_on = [couchbase-capella_query_indexes.build_idx]
}


# Example for non-deferred index build -
resource "couchbase-capella_query_indexes" "idx" {
  organization_id = "ffffffff-aaaa-1414-eeee-000000000000"
  project_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  cluster_id      = "ffffffff-aaaa-1414-eeee-000000000000"
  bucket_name     = "api"
  scope_name      = "metrics"
  collection_name = "memory"
  index_name      = "idx1"
  index_keys      = ["ram"]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `bucket_name` (String) The name of the bucket where the index will be created. Specifies the bucket part of the key space.
- `cluster_id` (String) The ID of the Capella cluster where the index will be created.
- `organization_id` (String) The ID of the Capella organization.
- `project_id` (String) The ID of the Capella project.

### Optional

- `build_indexes` (Set of String) List of index names to build.
- `collection_name` (String) Specifies the collection part of the key space. If unspecified, this will be the default collection.
- `index_keys` (List of String) List of document fields to index.
- `index_name` (String) The name of the index.
- `is_primary` (Boolean) Whether this is a primary index.
- `partition_by` (List of String) List of fields to partition the index by.
- `scope_name` (String) The name of the scope where the index will be created. Specifies the scope part of the key space. If unspecified, this will be the default scope.
- `where` (String) WHERE clause for the index.
- `with` (Attributes) Additional index configuration options. (see [below for nested schema](#nestedatt--with))

### Read-Only

- `status` (String) The current status of the index. For example 'Created', 'Ready', etc.

<a id="nestedatt--with"></a>
### Nested Schema for `with`

Optional:

- `defer_build` (Boolean) If true, the index will not be built immediately after creation.
- `num_partition` (Number) Number of partitions for the index.
- `num_replica` (Number) Number of index replicas to create.

## Import

Import is supported using the following syntax:

```shell
import couchbase-capella_query_indexes.idx1 index_name=idx1,collection_name=memory,scope_name=metrics,bucket_name=api,cluster_id=ffffffff-aaaa-1414-eeee-000000000000,project_id=ffffffff-aaaa-1414-eeee-000000000000,organization_id=ffffffff-aaaa-1414-eeee-000000000000
```

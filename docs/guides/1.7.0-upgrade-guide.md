---
layout: "couchbase-capella"
page_title: "Couchbase Capella Provider 1.7.0: Upgrade and Information Guide"
sidebar_current: "docs-couchbase-capella-guides-170-upgrade-guide"
description: |-
Couchbase Capella Provider 1.7.0: Upgrade and Information Guide
---

# Couchbase Capella Provider 1.7.0: Upgrade and Information Guide

Here is a list of what's new in 1.7.0

## New Features

### Cloud Snapshot Backups and Restore

Version 1.7.0 introduces comprehensive support for managing Cloud Snapshot Backups and Restore directly through Terraform. You can now create on-demand backups, configure backup schedules, manage backup retention policies, and monitor restore operations as Terraform resources.
  

**New Resources:**
* [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup) - Create and manage on-demand cloud snapshot backups
* [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule) - Configure automated backup schedules

**New Data Sources:**
* [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup) - Retrieve a single cloud snapshot backup
* [`couchbase-capella_cloud_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backups) - List all cloud snapshot backups for a cluster
* [`couchbase-capella_cloud_project_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_project_snapshot_backups) - List all cloud snapshot backups across a project
* [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup_schedule) - Retrieve the backup schedule configuration for a cluster
* [`couchbase-capella_cloud_snapshot_restore`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restore) - Retrieve a single snapshot restore operation
* [`couchbase-capella_cloud_snapshot_restores`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restores) - List all snapshot restore operations for a cluster

Example - Creating an on-demand cloud snapshot backup:

```terraform
resource "couchbase-capella_cloud_snapshot_backup" "daily_backup" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id

  retention       = 168  # Retention in hours (7 days)
  regions_to_copy = ["us-west-2"]  # Optional: copy to additional region (max 2)
}
```

Example - Configuring a backup schedule:

```terraform
resource "couchbase-capella_cloud_snapshot_backup_schedule" "weekly_schedule" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id

  interval        = 24        # Backup interval in hours
  retention       = 720       # Retention in hours (30 days)
  start_time      = "2024-01-01T02:00:00Z"
  copy_to_regions = ["us-east-1"]  # Optional: copy to additional regions
}
```

Example - Listing all backups for a cluster:

```terraform
data "couchbase-capella_cloud_snapshot_backups" "existing_backups" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}

output "backup_list" {
  value = data.couchbase-capella_cloud_snapshot_backups.existing_backups.data
}
```

Example - Listing all backups across a project:

```terraform
data "couchbase-capella_cloud_project_snapshot_backups" "project_backups" {
  organization_id = var.organization_id
  project_id      = var.project_id
}

output "project_backup_summary" {
  value = data.couchbase-capella_cloud_project_snapshot_backups.project_backups.data
}
```

Example - Retrieving the backup schedule for a cluster:

```terraform
data "couchbase-capella_cloud_snapshot_backup_schedule" "schedule" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}

output "backup_interval" {
  value = data.couchbase-capella_cloud_snapshot_backup_schedule.schedule.interval
}
```

Example - Retrieving a single restore operation:

```terraform
data "couchbase-capella_cloud_snapshot_restore" "restore" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}

output "restore_status" {
  value = data.couchbase-capella_cloud_snapshot_restore.restore.status
}
```

Example - Listing all restore operations for a cluster:

```terraform
data "couchbase-capella_cloud_snapshot_restores" "restores" {
  organization_id = var.organization_id
  project_id      = var.project_id
  cluster_id      = var.cluster_id
}

output "restore_history" {
  value = data.couchbase-capella_cloud_snapshot_restores.restores.data
}
```

**Additional Examples:**

For comprehensive examples of Cloud Snapshot Backup features, see:

* [Cloud Snapshot Backup](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/backup) - Creating and managing on-demand backups
* [Snapshot Backup Schedule](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/snapshot_backup_schedule) - Configuring automated backup schedules
* [Snapshot Restores](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/tree/main/examples/snapshot_restores) - Monitoring restore operations


## Bug Fixes

* **GSI Schema and Import Fixes**: Reverted the GSI datasource and monitor schemas to their original state to fix unintentional schema changes, and fixed a null pointer exception that occurred during GSI index imports.
* **GSI Replica Handling**: Added validation to prevent setting `num_replicas` to zero (which is not supported), and fixed an issue where a zero value was not being properly populated.
* **Optional Field Defaults**: Corrected handling of optional fields that have non-zero defaults on the server side, ensuring the provider does not unintentionally override server-determined values.


## Changes

There are no deprecations as part of this release.

1.7.0 includes new features and general improvements. See the [CHANGELOG](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/CHANGELOG.md) for more specific information.

### New Resources and Data Sources

* Manage Cloud Snapshot Backups [`couchbase-capella_cloud_snapshot_backup`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup)
* Manage Backup Schedules [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/resources/cloud_snapshot_backup_schedule)
* Retrieve Cloud Snapshot Backups [`couchbase-capella_cloud_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backups)
* Retrieve Project-Level Backups [`couchbase-capella_cloud_project_snapshot_backups`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_project_snapshot_backups)
* Retrieve Backup Schedule [`couchbase-capella_cloud_snapshot_backup_schedule`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_backup_schedule)
* Retrieve Snapshot Restore [`couchbase-capella_cloud_snapshot_restore`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restore)
* Retrieve Snapshot Restores [`couchbase-capella_cloud_snapshot_restores`](https://registry.terraform.io/providers/couchbasecloud/couchbase-capella/latest/docs/data-sources/cloud_snapshot_restores)

## Notes

### Migration from Older Versions

If you're upgrading from an earlier version of the provider:

1. **GSI Configurations**: If you experienced issues with GSI data sources or monitors in previous versions, these have been resolved. No action is required, but you may want to verify your GSI configurations after upgrading.

2. **Default Value Change for GSI `num_replica` Field**: The `with.num_replica` field in the `couchbase-capella_query_indexes` resource has changed:
   - **Previous behavior**: `num_replica` may have required explicit specification or had a hardcoded default to zero
   - **Current behavior (post-1.7.0)**: `num_replica` is now computed and known after apply operation, and defined by server (server-determined)

### Helpful Links

- [Getting Started with the Terraform Provider](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples/getting_started)
- [Capella Management API v4.0](https://docs.couchbase.com/cloud/management-api-reference/index.html)
- [See Specific Examples](https://github.com/couchbasecloud/terraform-provider-couchbase-capella/blob/master/examples)
